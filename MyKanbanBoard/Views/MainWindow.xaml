<Window x:Class="MyKanbanBoard.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MyKanbanBoard"
        xmlns:enums="clr-namespace:MyKanbanBoard.Models"
        xmlns:vm="clr-namespace:MyKanbanBoard.ViewModels"
        mc:Ignorable="d"
        Title="MainWindow"
        Height="450"
        Width="800">

    <Window.DataContext>
        <vm:BoardViewModel />
    </Window.DataContext>

    <DockPanel>

        <Border DockPanel.Dock="Top" Padding="10" Background="#FAFAFA">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="10"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- RZĄD 1: Sprint -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="260"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="90"/>
                    </Grid.ColumnDefinitions>

                    <ComboBox Grid.Column="0"
                      ItemsSource="{Binding Sprints}"
                      SelectedItem="{Binding ActiveSprint}"
                      DisplayMemberPath="Name"
                      Height="28"/>

                    <TextBox Grid.Column="2"
                     Text="{Binding NewSprintName, UpdateSourceTrigger=PropertyChanged}"
                     Height="28"
                     VerticalContentAlignment="Center"
                     Margin="0,0,8,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding AddSprintCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <Button Grid.Column="3"
                    Content="Add Sprint"
                    Height="28"
                    Command="{Binding AddSprintCommand}"/>
                </Grid>

                <!-- RZĄD 2: User Story -->
                <Grid Grid.Row="2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="260"/>
                        <ColumnDefinition Width="12"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="90"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                       VerticalAlignment="Center"
                       Text="{Binding ActiveSprint.Name, StringFormat=Active: {0}}"
                       Opacity="0.8"/>

                    <TextBox Grid.Column="2"
                     Text="{Binding NewStoryTitle, UpdateSourceTrigger=PropertyChanged}"
                     Height="28"
                     VerticalContentAlignment="Center"
                     Margin="0,0,8,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding AddStoryCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <Button Grid.Column="3"
                    Content="Add Story"
                    Height="28"
                    Command="{Binding AddStoryCommand}"/>
                </Grid>
            </Grid>
        </Border>

        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding ActiveSprint.Stories}">
            <ItemsControl.ItemTemplate>
                <DataTemplate>

                    <Expander IsExpanded="{Binding IsExpanded}" Margin="10">
                        <Expander.Header>
                            <TextBlock Text="{Binding Title}"
                                       FontSize="16"
                                       FontWeight="Bold" />
                        </Expander.Header>

                        <!--  Wiersz: 4 kolumny statusów  -->
                        <Grid Margin="0 10 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>

                            <!--  TO DO  -->
                            <Border Grid.Column="0"
                                    Margin="5"
                                    Padding="8"
                                    Background="#F3F3F3"
                                    AllowDrop="True"
                                    Drop="Cell_Drop"
                                    Tag="{x:Static enums:TaskStatus.ToDo}">

                                <StackPanel>

                                    <!--  Nagłówek + dodawanie  -->
                                    <DockPanel Margin="0 0 0 6">
                                        <TextBlock Text="To Do"
                                                   FontWeight="Bold"
                                                   DockPanel.Dock="Left" />

                                        <Button Content="＋"
                                                Width="26"
                                                Height="26"
                                                Margin="6 0 0 0"
                                                DockPanel.Dock="Right"
                                                Command="{Binding AddTaskCommand}" />
                                    </DockPanel>

                                    <!--  Pole na tytuł taska  -->
                                    <TextBox Text="{Binding NewTaskTitle, UpdateSourceTrigger=PropertyChanged}"
                                             Margin="0 0 0 8"
                                             Height="28" 
                                             KeyDown="NewTaskTitle_KeyDown" />

                                    <ItemsControl ItemsSource="{Binding ToDoView}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="White"
                                                        Padding="10"
                                                        Margin="0 0 0 5"
                                                        CornerRadius="4"
                                                        MouseMove="Task_MouseMove">
                                                    <TextBlock Text="{Binding Title}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!--  ACTIVE  -->
                            <Border Grid.Column="1"
                                    Margin="5"
                                    Padding="8"
                                    Background="#F3F3F3"
                                    AllowDrop="True"
                                    Drop="Cell_Drop"
                                    Tag="{x:Static enums:TaskStatus.Active}">
                                <StackPanel>
                                    <TextBlock Text="Active"
                                               FontWeight="Bold"
                                               Margin="0 0 0 6" />
                                    <ItemsControl ItemsSource="{Binding ActiveView}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="White"
                                                        Padding="10"
                                                        Margin="0 0 0 5"
                                                        CornerRadius="4"
                                                        MouseMove="Task_MouseMove">
                                                    <TextBlock Text="{Binding Title}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!--  PAUSED  -->
                            <Border Grid.Column="2"
                                    Margin="5"
                                    Padding="8"
                                    Background="#F3F3F3"
                                    AllowDrop="True"
                                    Drop="Cell_Drop"
                                    Tag="{x:Static enums:TaskStatus.Paused}">
                                <StackPanel>
                                    <TextBlock Text="Paused"
                                               FontWeight="Bold"
                                               Margin="0 0 0 6" />
                                    <ItemsControl ItemsSource="{Binding PausedView}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="White"
                                                        Padding="10"
                                                        Margin="0 0 0 5"
                                                        CornerRadius="4"
                                                        MouseMove="Task_MouseMove">
                                                    <TextBlock Text="{Binding Title}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>

                            <!--  DONE  -->
                            <Border Grid.Column="3"
                                    Margin="5"
                                    Padding="8"
                                    Background="#F3F3F3"
                                    AllowDrop="True"
                                    Drop="Cell_Drop"
                                    Tag="{x:Static enums:TaskStatus.Done}">
                                <StackPanel>
                                    <TextBlock Text="Done"
                                               FontWeight="Bold"
                                               Margin="0 0 0 6" />
                                    <ItemsControl ItemsSource="{Binding DoneView}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Background="White"
                                                        Padding="10"
                                                        Margin="0 0 0 5"
                                                        CornerRadius="4"
                                                        MouseMove="Task_MouseMove">
                                                    <TextBlock Text="{Binding Title}" />
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </Expander>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </ScrollViewer>
    </DockPanel>
</Window>